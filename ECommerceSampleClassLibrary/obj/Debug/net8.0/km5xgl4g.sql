CREATE TABLE IF NOT EXISTS "__EFMigrationsHistory" (
    "MigrationId" character varying(150) NOT NULL,
    "ProductVersion" character varying(32) NOT NULL,
    CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY ("MigrationId")
);

START TRANSACTION;

CREATE TABLE "Customer" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "FirstName" character varying(256) NOT NULL,
    "LastName" character varying(256) NOT NULL,
    "Email" character varying(256) NOT NULL,
    "PhoneNumber" character varying(50) NOT NULL,
    CONSTRAINT "PK_Customer" PRIMARY KEY ("Id")
);

CREATE TABLE "ProductCategory" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "Name" character varying(256) NOT NULL,
    CONSTRAINT "PK_ProductCategory" PRIMARY KEY ("Id")
);

CREATE TABLE "Product" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "CategoryId" integer NOT NULL,
    "Name" character varying(256) NOT NULL,
    "Quantity" integer NOT NULL,
    "Measurement" character varying(256) NOT NULL,
    CONSTRAINT "PK_Product" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_Product_ProductCategory_CategoryId" FOREIGN KEY ("CategoryId") REFERENCES "ProductCategory" ("Id") ON DELETE CASCADE
);

CREATE TABLE "Order" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "CustomerId" integer NOT NULL,
    "ProductId" integer NOT NULL,
    "Quantity" integer NOT NULL,
    "Status" character varying(256) NOT NULL,
    CONSTRAINT "PK_Order" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_Order_Customer_CustomerId" FOREIGN KEY ("CustomerId") REFERENCES "Customer" ("Id") ON DELETE CASCADE,
    CONSTRAINT "FK_Order_Product_ProductId" FOREIGN KEY ("ProductId") REFERENCES "Product" ("Id") ON DELETE CASCADE
);

CREATE INDEX "IX_Order_CustomerId" ON "Order" ("CustomerId");

CREATE INDEX "IX_Order_ProductId" ON "Order" ("ProductId");

CREATE INDEX "IX_Product_CategoryId" ON "Product" ("CategoryId");

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20240129160949_TableCreation', '8.0.1');

COMMIT;

START TRANSACTION;

ALTER TABLE "ProductCategory" ALTER COLUMN "Id" TYPE uuid;
ALTER TABLE "ProductCategory" ALTER COLUMN "Id" DROP IDENTITY;

ALTER TABLE "Product" ALTER COLUMN "CategoryId" TYPE uuid;

ALTER TABLE "Product" ALTER COLUMN "Id" TYPE uuid;
ALTER TABLE "Product" ALTER COLUMN "Id" DROP IDENTITY;

ALTER TABLE "Order" ALTER COLUMN "ProductId" TYPE uuid;

ALTER TABLE "Order" ALTER COLUMN "CustomerId" TYPE uuid;

ALTER TABLE "Order" ALTER COLUMN "Id" TYPE uuid;
ALTER TABLE "Order" ALTER COLUMN "Id" DROP IDENTITY;

ALTER TABLE "Customer" ALTER COLUMN "Id" TYPE uuid;
ALTER TABLE "Customer" ALTER COLUMN "Id" DROP IDENTITY;

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20240130151739_changedStructure', '8.0.1');

COMMIT;

